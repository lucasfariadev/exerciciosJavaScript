<!DOCTYPE html>
<html>
    <head>
        <title>Bricks Breaker</title>
        <style>
        * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: #f1f1f1;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }
        
        canvas {
            border: 1px solid #ccc;
        }
    </style>
    </head>
    <body>
        <canvas id="gameCanvas" width="480" height="320"></canvas>

        <script>

var powerAtivo = {
    x: 0,
    y: 0,
    largura: 20,
    altura: 20,
    dy: 0.5,
    ativo: false,
    caindo: false
};

        var canvas = document.getElementById("gameCanvas");
        var ctx = canvas.getContext("2d");
        
        var alturaBarra = 10;
        var larguraBarra = 75;
        var posicaoBarraX = (canvas.width - larguraBarra) / 2;
        
        var raioBola = 10;
        var posicaoBolaX = canvas.width / 2;
        var posicaoBolaY = canvas.height - 30;
        var velocidadeBolaX = 2;
        var velocidadeBolaY = -2;
        
        var numeroLinhasBlocos = 3;
        var numeroColunasBlocos = 5;
        var larguraBloco = 75;
        var alturaBloco = 20;
        var espacamentoBlocos = 10;
        var deslocamentoSuperiorBlocos = 30;
        var deslocamentoEsquerdaBlocos = 30;
        
        var blocos = [];
        for(var c = 0; c < numeroColunasBlocos; c++) {
            blocos[c] = [];
            for(var r = 0; r < numeroLinhasBlocos; r++) {
                var powerUpAleatorio = Math.random() > 0.8; // Chance de 20% de ter um power-up
                blocos[c][r] = { x: 0, y: 0, status: 1, powerUp: powerUpAleatorio, powerUpAtivo: false };
            }
        }
        
        var pontuacao = 0;
        var numeroBolas = 1; // Número inicial de bolas
        
        var teclaDireitaPressionada = false;
        var teclaEsquerdaPressionada = false;
        
        function desenharBarra() {
            ctx.beginPath();
            ctx.rect(posicaoBarraX, canvas.height - alturaBarra, larguraBarra, alturaBarra);
            ctx.fillStyle = "#0095DD";
            ctx.fill();
            ctx.closePath();
        }
        
        function desenharBola() {
            ctx.beginPath();
            ctx.arc(posicaoBolaX, posicaoBolaY, raioBola, 0, Math.PI*2);
            ctx.fillStyle = "#0095DD";
            ctx.fill();
            ctx.closePath();
        }
        
        function desenharBlocos() {
            for(var c = 0; c < numeroColunasBlocos; c++) {
                for(var r = 0; r < numeroLinhasBlocos; r++) {
                    if(blocos[c][r].status == 1) {
                        var posicaoBlocoX = (c * (larguraBloco + espacamentoBlocos)) + deslocamentoEsquerdaBlocos;
                        var posicaoBlocoY = (r * (alturaBloco + espacamentoBlocos)) + deslocamentoSuperiorBlocos;
                        blocos[c][r].x = posicaoBlocoX;
                        blocos[c][r].y = posicaoBlocoY;
                        ctx.beginPath();
                        ctx.rect(posicaoBlocoX, posicaoBlocoY, larguraBloco, alturaBloco);
                        ctx.fillStyle = "#0095DD";
                        ctx.fill();
                        ctx.closePath();
                        
                        if (blocos[c][r].powerUp && !blocos[c][r].powerUpAtivo) {
                            ctx.beginPath();
                            ctx.rect(posicaoBlocoX + larguraBloco / 2 - 10, posicaoBlocoY + alturaBloco / 2 - 10, 20, 20);
                            ctx.fillStyle = "#FF0000";
                            ctx.fill();
                            ctx.closePath();
                        }
                    }
                }
            }
        }
        
        function desenharPontuacao() {
            ctx.font = "16px Arial";
            ctx.fillStyle = "#0095DD";
            ctx.fillText("Pontuação: " + pontuacao, 8, 20);
        }
        
        function desenharBolas() {
            for (var i = 0; i < numeroBolas; i++) {
                ctx.beginPath();
                ctx.arc(posicaoBolaX, posicaoBolaY, raioBola, 0, Math.PI*2);
                ctx.fillStyle = "#0095DD";
                ctx.fill();
                ctx.closePath();
            }
        }
        
        function deteccaoColisao() {
            for(var c = 0; c < numeroColunasBlocos; c++) {
                for(var r = 0; r < numeroLinhasBlocos; r++) {
                    var bloco = blocos[c][r];
                    if(bloco.status == 1) {
                        if(posicaoBolaX > bloco.x && posicaoBolaX < bloco.x + larguraBloco && posicaoBolaY > bloco.y && posicaoBolaY < bloco.y + alturaBloco) {
                            velocidadeBolaY = -velocidadeBolaY;
                            bloco.status = 0;
                            pontuacao++;
                            
                            if (bloco.powerUp && !bloco.powerUpAtivo) {
                                ativarPowerUp(c, r);
                            }
                            
                            if(pontuacao == numeroLinhasBlocos * numeroColunasBlocos) {
                                alert("Parabéns! Você venceu!");
                                document.location.reload();
                            }
                        }
                    }
                }
            }
        }
        
        function ativarPowerUp(coluna, linha) {
            blocos[coluna][linha].powerUpAtivo = true;
            
            var tipoPowerUp = Math.random();
            if (tipoPowerUp < 0.5) {
                // Power-up: Duplicar a quantidade de bolas
                numeroBolas *= 2;
            } else {
                // Power-up: Aumentar o tamanho da barra
                larguraBarra += 20;
                posicaoBarraX -= 10;
            }

            powerAtivo.x = blocos[coluna][linha].x + larguraBloco / 2 - powerAtivo.largura / 2;
    powerAtivo.y = blocos[coluna][linha].y + alturaBloco / 2 - powerAtivo.altura / 2;
    
    powerAtivo.ativo = true;
    powerAtivo.caindo = true;
        }

        function desenharPowerAtivo() {
    if (powerAtivo.ativo) {
        ctx.beginPath();
        ctx.rect(powerAtivo.x, powerAtivo.y, powerAtivo.largura, powerAtivo.altura);
        ctx.fillStyle = "#FF0000";
        ctx.fill();
        ctx.closePath();
    }
}
function colisaoBarraPowerAtivo() {
    if (powerAtivo.ativo) {
        if (
            powerAtivo.y + powerAtivo.altura >= canvas.height - alturaBarra &&
            powerAtivo.x + powerAtivo.largura >= posicaoBarraX &&
            powerAtivo.x <= posicaoBarraX + larguraBarra
        ) {
            // Colisão detectada
            powerAtivo.ativo = false;
            powerAtivo.caindo = false;
            
            // Realize a ação desejada quando a barra acertar o poder ativo
            // Por exemplo, você pode adicionar pontuação, vidas extras, etc.
        }
    }
}


        
        function desenhar() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            desenharBlocos();
            desenharBarra();
            desenharBolas();
            desenharPowerAtivo();
            desenharPontuacao();
            deteccaoColisao();
            
            if(posicaoBolaX + velocidadeBolaX > canvas.width - raioBola || posicaoBolaX + velocidadeBolaX < raioBola) {
                velocidadeBolaX = -velocidadeBolaX;
            }
            if (powerAtivo.ativo) {
        if (powerAtivo.caindo) {
            powerAtivo.y += powerAtivo.dy;
            
            if (powerAtivo.y > canvas.height) {
                powerAtivo.ativo = false;
                powerAtivo.caindo = false;
            }
        }
    }
            if(posicaoBolaY + velocidadeBolaY < raioBola) {
                velocidadeBolaY = -velocidadeBolaY;
            } else if(posicaoBolaY + velocidadeBolaY > canvas.height - raioBola - alturaBarra) {
                if(posicaoBolaX > posicaoBarraX && posicaoBolaX < posicaoBarraX + larguraBarra) {
                    velocidadeBolaY = -velocidadeBolaY;
                } else {
                    // Game over
                    alert("Game Over");
                    document.location.reload();
                }
            }
            if (powerAtivo.ativo) {
        if (powerAtivo.caindo) {
            powerAtivo.y += powerAtivo.dy;
            
            if (powerAtivo.y > canvas.height) {
                powerAtivo.ativo = false;
                powerAtivo.caindo = false;
            }
        }
        
        colisaoBarraPowerAtivo();
    }
            
            posicaoBolaX += velocidadeBolaX;
            posicaoBolaY += velocidadeBolaY;
            
            if(teclaDireitaPressionada && posicaoBarraX < canvas.width - larguraBarra) {
                posicaoBarraX += 7;
            } else if(teclaEsquerdaPressionada && posicaoBarraX > 0) {
                posicaoBarraX -= 7;
            }
            
            requestAnimationFrame(desenhar);
        }
        
        function pressionarTecla(event) {
            if(event.keyCode == 39) {
                teclaDireitaPressionada = true;
            } else if(event.keyCode == 37) {
                teclaEsquerdaPressionada = true;
            }
        }
        
        function soltarTecla(event) {
            if(event.keyCode == 39) {
                teclaDireitaPressionada = false;
            } else if(event.keyCode == 37) {
                teclaEsquerdaPressionada = false;
            }
        }
        
        document.addEventListener("keydown", pressionarTecla, false);
        document.addEventListener("keyup", soltarTecla, false);
        
        desenhar();
    </script>
    </body>
</html>
